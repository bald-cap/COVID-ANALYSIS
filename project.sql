-- TEMPERATURE TABLE
CREATE TABLE TEMPERATURES(
    -- ID_TEMP INT AUTO_INCREMENT PRIMARY KEY,
    DATE_TEMP DATE,
    DEP_ID VARCHAR(3),
    DEPARTMENT VARCHAR(50),
    MIN_TEMP DECIMAL(10, 2),
    MAX_TEMP DECIMAL(10, 2),
    MEAN_TEMP DECIMAL(10, 2),

    PRIMARY KEY (DATE_TEMP, DEP_ID),
    -- FOREIGN KEY (DEP_ID) REFERENCES PROJET_DEP(codeD)
);

ALTER TABLE TEMPERATURES ADD CONSTRAINT temp_depID_fk FOREIGN KEY (DEP_ID) REFERENCES PROJET_DEP(codeD);

--DELETING DATA BEYOND 2021
DELETE
FROM TEMPERATURES
WHERE DATE_TEMP LIKE "2022-%" OR DATE_TEMP LIKE "2023-%" OR DATE_TEMP LIKE "2024-%";


--CLEANED DATA -> REMOVED 0 from DEP_ID TO ALLOW JOIN eg. '07' BECOMES '7'
UPDATE TEMPERATURES
SET DEP_ID = SUBSTRING(DEP_ID, 2)
WHERE DEP_ID LIKE '0%';



------------------------------------------------------------------------------------------------------------



-- HOSPITALISATION TABLE
CREATE TABLE HOSPITALISATIONS(
    -- ID_HOSP INT AUTO_INCREMENT PRIMARY KEY,
    DEP_ID VARCHAR(3),
    SEX INT,
    DATE_HOSP DATE,
    NUM_HOSP INT,
    NUM_INTENSE_CARE INT,
    NUM_CONV_HOSP INT,
    NUM_SSR_USLD INT,
    NUM_OTHERS INT,
    NUM_RETURN_HOME INT,
    NUM_DEATHS INT,

    PRIMARY KEY (DEP_ID, DATE_HOSP, SEX),
    -- FOREIGN KEY (DEP_ID) REFERENCES PROJET_DEP (codeD)
);

ALTER TABLE HOSPITALISATIONS ADD CONSTRAINT hosp_depID_fk FOREIGN KEY (DEP_ID) REFERENCES PROJET_DEP (codeD);

SELECT DATE_HOSP, DEP_ID, NUM_HOSP
FROM HOSPITALISATIONS
WHERE DATE_HOSP LIKE "2019-%" OR DATE_HOSP LIKE "2020-%"
ORDER BY DATE_HOSP ASC;

--DELETING DATA BEYOND 2021
DELETE
FROM HOSPITALISATIONS
WHERE DATE_HOSP LIKE "2022-%" OR DATE_HOSP LIKE "2023-%";

--CLEANED DATA -> REMOVED 0 from DEP_ID TO ALLOW JOIN eg '02' BECOMES '2'
UPDATE HOSPITALISATIONS
SET DEP_ID = SUBSTRING(DEP_ID, 2)
WHERE DEP_ID LIKE '0%'