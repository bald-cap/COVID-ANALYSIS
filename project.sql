-- TEMPERATURE TABLE
CREATE TABLE TEMPERATURES(
    -- ID_TEMP INT AUTO_INCREMENT PRIMARY KEY,
    DATE_TEMP DATE,
    DEP_ID VARCHAR(3),
    DEPARTMENT VARCHAR(50),
    MIN_TEMP DECIMAL,
    MAX_TEMP DECIMAL,
    MEAN_TEMP DECIMAL
);

ALTER TABLE TEMPERATURES ADD COLUMN ID_TEMP INT AUTO_INCREMENT PRIMARY KEY;

CREATE VIEW DATES_TEMP_VIEW AS
SELECT ID_TEMP, DATE_TEMP, DEP_ID
FROM TEMPERATURES;

--DELETING DATA BEYOND 2021
DELETE
FROM TEMPERATURES
WHERE DATE_TEMP LIKE "2022-%" OR DATE_TEMP LIKE "2023-%" OR DATE_TEMP LIKE "2024-%";


--DATA REPEATS 96 times PER DAY -> TEMP OF ALL DEPARTMENTS EVERY DAY
SELECT COUNT(DATE_TEMP), DATE_TEMP
FROM TEMPERATURES
WHERE DATE_HOSP = '2021-12-31'
GROUP BY DATE_TEMP;


-- HOSPITALISATION TABLE
CREATE TABLE HOSPITALISATIONS(
    -- ID_HOP INT AUTO_INCREMENT PRIMARY KEY,
    DEP_ID VARCHAR(3),
    SEX INT,
    DATE_HOSP DATE,
    NUM_HOSP INT,
    NUM_INTENSE_CARE INT,
    NUM_CONV_HOSP INT,
    NUM_SSR_USLD INT,
    NUM_OTHERS INT,
    NUM_RETURN_HOME INT,
    NUM_DEATHS INT
);

ALTER TABLE HOSPITALISATIONS DROP COLUMN ID_HOP;
ALTER TABLE HOSPITALISATIONS ADD COLUMN ID_HOP INT AUTO_INCREMENT PRIMARY KEY;

SELECT DATE_HOSP, DEP_ID, NUM_HOSP
FROM HOSPITALISATIONS
WHERE DATE_HOSP LIKE "2019-%" OR DATE_HOSP LIKE "2020-%"
ORDER BY DATE_HOSP ASC;

--DELETING DATA BEYOND 2021
DELETE
FROM HOSPITALISATIONS
WHERE DATE_HOSP LIKE "2022-%" OR DATE_HOSP LIKE "2023-%";

--DATE_HOSP DOES NOT REPEEAT -> POSSIBLE PRIMARY KEY/ FOREIGN KEY | FALSE
--DATA REPEATS 305 times PER DAY -> THREE TUPLES PER DEPARTMENT EVERYDAY
--SEX(0) -> MEN + WOMEN
--SEX(1) -> MEN
--SEX(2) -> WOMEN
SELECT COUNT(DATE_HOSP), DATE_HOSP, SEX
FROM HOSPITALISATIONS
WHERE DATE_HOSP = '2021-12-31'
GROUP BY DATE_HOSP;


--TODO -> CREATE VIEWS FOR EVERYDAY, FOR EVERY SEX, PRIMARY KEY - DATES