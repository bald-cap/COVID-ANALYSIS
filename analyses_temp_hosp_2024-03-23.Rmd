---
title: "COVID_TEMP_HOSP_ANALYSIS"
author: "
  Michael NYANYUIE,
  Divine IZERE
  Lucky BERNICE
  Medhi 
  Rayane "
date: "2024-03-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load-data}
library(RMariaDB)

password <- rstudioapi::askForPassword("UT2J Password")
connection <- dbConnect(
  drv = RMariaDB::MariaDB(),
  user = "michael-kofi.nyanyui",
  password = password,
  dbname = "23_2L2_michael_kofi_nyanyuie",
  host = "10.10.190.39",
  port = 3306
)
```

## CREATION DE BASE DE DONNEE.
```{r BASE DE DONNEE en SQL}
#### TEMPERATURE TABLE
CREATE TABLE TEMPERATURES(
  DATE_TEMP DATE,
  DEP_ID VARCHAR(3),
  DEPARTMENT VARCHAR(50),
  MIN_TEMP DECIMAL(10, 2),
  MAX_TEMP DECIMAL(10, 2),
  MEAN_TEMP DECIMAL(10, 2),

  PRIMARY KEY (DATE_TEMP, DEP_ID),
  FOREIGN KEY (DEP_ID) REFERENCES PROJET_DEP(codeD)
);

#### HOSPITALISATION TABLE
CREATE TABLE HOSPITALISATIONS(
  DEP_ID VARCHAR(3),
  SEX INT,
  DATE_HOSP DATE,
  NUM_HOSP INT,
  NUM_INTENSE_CARE INT,
  NUM_CONV_HOSP INT,
  NUM_SSR_USLD INT,
  NUM_OTHERS INT,
  NUM_RETURN_HOME INT,
  NUM_DEATHS INT,

  PRIMARY KEY (DEP_ID, DATE_HOSP, SEX),
  FOREIGN KEY (DEP_ID) REFERENCES PROJET_DEP (codeD)
);
```
## ETUDE DE VARIABLE HOSPITALISATION

On aimerais étudier le taux d'hospitalisations en fonctions de saisons

```{r TAUX D'HOSPITALISATION PAR SAISON}
hosp_rate_10K <- dbGetQuery(
  connection,
  "SELECT
    AVG((NUM_HOSP/total) * 10000) AS HOSP_RATE,
    CASE
      WHEN MONTH(DATE_HOSP) IN (12, 1, 2) THEN 'Winter'
      WHEN MONTH(DATE_HOSP) IN (3, 4, 5) THEN 'Spring'
      WHEN MONTH(DATE_HOSP) IN (6, 7, 8) THEN 'Summer'
      WHEN MONTH(DATE_HOSP) IN (9, 10, 11) THEN 'Autumn'
    END AS 'SEASONS'
  FROM HOSPITALISATIONS H
  INNER JOIN PROJET_POPU P
    ON H.DEP_ID = P.codeD
  GROUP BY SEASONS
  ORDER BY HOSP_RATE DESC"
)

print(hosp_rate_10K)
```
On remarque alors un fort taux d'hospitalisation en Hiver et les saisons plus froides que l'Été.

## COEFFICIENT DE CORRELATION ENTRE LA TEMPERATURE ET LE TAUX D'HOSPITALISATIONS

You can also embed plots, for example:

```{r GRAPH DE OEFFICIENT DE CORRELATION (TEMP vs TAUX HOSP) pressure, echo=FALSE}
temps_hosp_data <- dbSendQuery(
  connection,
  "SELECT MEAN_TEMP, ((NUM_HOSP/total) * 10000) AS HOSP_RATE_10K
  FROM TEMPERATURES T
  RIGHT JOIN HOSPITALISATIONS H
    ON H.DEP_ID = T.DEP_ID AND H.DATE_HOSP = T.DATE_TEMP
  INNER JOIN PROJET_POPU P
    ON P.codeD = H.DEP_ID
  WHERE SEX = 0 AND T.DEP_ID IS NOT NULL AND H.DATE_HOSP IS NOT NULL
  GROUP BY DATE_TEMP
  ORDER BY HOSP_RATE_10K DESC, MEAN_TEMP DESC"
)

cor_hosp_temp <- cor(
  temps_hosp_data$MEAN_TEMP,
  temps_hosp_data$HOSP_RATE_10K
)

plot(
  temps_hosp_data$MEAN_TEMP,
  temps_hosp_data$HOSP_RATE_10K,
  main = "SCATTER PLOT OF TEMP VS HOSPITALISATION RATE",
  xlab = "AVERAGE TEMPERAUTRES",
  ylab = "HOSPITALISATION RATE PER 10K",
  pch = 20
)
```
J’ai utilisé 10 000 habitants comme référence pour standardiser le taux d’hospitalisation. Selon le calcul du coefficient de corrélation, qui est de -0.21, il existe une faible relation négative entre la température et le taux d’hospitalisation. Cela suggère une légère tendance à la baisse des hospitalisations avec l’augmentation des températures. Toutefois, cette relation est faible et indique que d’autres facteurs pourraient jouer un rôle plus significatif dans les taux d’hospitalisation. Cette analyse met en lumière la complexité des facteurs affectant les hospitalisations et souligne l’importance d’une approche multifactorielle pour comprendre les défis des systèmes de santé. 


## Indice CDD/HDD
```{r GRAPH DE l'INDICE CDD/HDD}
cdd_hdd_query <- "
WITH HEATING_DAYS AS(
  SELECT SUM(18 - MEAN_TEMP) AS HDD, YEAR(DATE_TEMP) AS YEARS
  FROM TEMPERATURES
  WHERE MEAN_TEMP < 18
  GROUP BY YEARS
), COOLING_DAYS AS(
  SELECT SUM(MEAN_TEMP - 18) AS CDD, YEAR(DATE_TEMP) AS YEARS
  FROM TEMPERATURES
  WHERE MEAN_TEMP > 18
  GROUP BY YEARS
) 

SELECT
  YEAR(T.DATE_TEMP) AS YEARS,
  CD.CDD/HD.HDD AS `CDD/HDD INDEX`
FROM TEMPERATURES T
LEFT JOIN HEATING_DAYS HD
  ON YEAR(T.DATE_TEMP) = HD.YEARS
LEFT JOIN COOLING_DAYS CD
  ON CD.YEARS = YEAR(T.DATE_TEMP)
GROUP BY YEARS
ORDER BY YEARS ASC
"

cdd_hdd_data <- dbGetQuery(connection, cdd_hdd_query)

cdd_data$YEARS <- as.factor(cdd_data$YEARS)

plot(cdd_data$YEARS, cdd_data$`CDD INDEX`,
  type = "b",
  pch = 19,
  lty = 1,
  xlab = "Year",
  ylab = "CDD Index",
  main = "CDD Index Over Years"
)

```
L’indice CDD/HDD de 2018 à 2021 reflète partiellement la corrélation faible et négative trouvée entre les températures et les hospitalisations. Nous observons que les bâtiments nécessitaient davantage de chauffage entre 2018 et 2020, signifiant des températures généralement plus basses, tandis que les indices CDD et HDD tendent à se rapprocher en 2021, indiquant une année avec des températures relativement plus équilibrées. Cependant, étant donné la faible corrélation entre la température et les taux d’hospitalisation, il serait prématuré de conclure directement que les cas de COVID-19 ont diminué au fil des ans en se basant uniquement sur cet indice.