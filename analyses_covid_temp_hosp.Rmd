---
title: "COVID_TEMP_HOSP_ANALYSIS"
author: "
  Michael NYANYUIE,
  Divine IZERE
  Lucky BERNICE
  Medhi 
  Rayane "
date: "2024-03-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# INTRODUCTION
---------------
Cette analyse se penche sur la relation complexe entre les données d’hospitalisation et les variations de température durant la pandémie de COVID-19, couvrant les années 2019 à 2020, avec une perspective comparative des années 2018 et 2021. Elle vise à éclairer sur la manière dont les facteurs environnementaux pourraient corréler avec les tendances de santé publique au cours de l’une des crises sanitaires mondiales les plus difficiles de l’histoire récente.


## OBJECTIFS
---------------
Nos objectifs sont multiples :

	•	Analyser les taux d’hospitalisation pour identifier les tendances clés et les fluctuations saisonnières.
	•	Examiner l’impact potentiel des variations de température sur les taux d’hospitalisation, offrant des perspectives sur les influences environnementales sur la dynamique de la pandémie.
	•	Investiguer la relation entre les admissions en soins intensifs et les taux de mortalité, évaluant si un taux élevé de cas graves conduit à une augmentation des décès.
	•	Explorer les modèles saisonniers dans le contexte des hospitalisations et des décès, identifiant les périodes critiques de l’année.
	•	Employer des techniques statistiques telles que les coefficients de corrélation de Pearson et l’analyse des séries temporelles, appuyées par des représentations visuelles des données, pour articuler nos découvertes de manière exhaustive.

# ANALYSES
------------
## ACCES A LA BADR DE DONNÉE EN R
```{r accès a la base de données via RMariaDB}
library(RMariaDB)

password <- rstudioapi::askForPassword("UT2J Password")
connection <- dbConnect(
  drv = RMariaDB::MariaDB(),
  user = "michael-kofi.nyanyui",
  password = password,
  dbname = "23_2L2_michael_kofi_nyanyuie",
  host = "10.10.190.39",
  port = 3306
)
```

## CREATION DE BASE DE DONNÉES.
-------------------------------
```{r BASE DE DONNEES en SQL}
### TEMPERATURES TABLE
# CREATE TABLE TEMPERATURES(
#   DATE_TEMP DATE,
#   DEP_ID VARCHAR(3),
#   DEPARTMENT VARCHAR(50),
#   MIN_TEMP DECIMAL(10, 2),
#   MAX_TEMP DECIMAL(10, 2),
#   MEAN_TEMP DECIMAL(10, 2),

#   PRIMARY KEY (DATE_TEMP, DEP_ID),
#   FOREIGN KEY (DEP_ID) REFERENCES PROJET_DEP(codeD)
# );

### HOSPITALISATIONS TABLE
# CREATE TABLE HOSPITALISATIONS(
#   DEP_ID VARCHAR(3),
#   SEX INT,
#   DATE_HOSP DATE,
#   NUM_HOSP INT,
#   NUM_INTENSE_CARE INT,
#   NUM_CONV_HOSP INT,
#   NUM_SSR_USLD INT,
#   NUM_OTHERS INT,
#   NUM_RETURN_HOME INT,
#   NUM_DEATHS INT,

#   PRIMARY KEY (DEP_ID, DATE_HOSP, SEX),
#   FOREIGN KEY (DEP_ID) REFERENCES PROJET_DEP (codeD)
# );
```
## ETUDE DE VARIABLE HOSPITALISATION
------------------------------------
### LA CORRELATION ENTRE LE TAUX DE CAS INTENSE ET LE TAUX DE MORTS
On aimerais etudier la correlation entre le taux de cas intense et le taux de morts.

```{r GRAPHE CORRELATION ENTRE LE TAUX DE CAS INTENSE ET LE TAUX DE MORTS}
intense_case_deaths_data <- dbSendQuery(
  connection,
  "SELECT
    ((NUM_INTENSE_CARE/total) * 10000) AS INTENSE_CARE_10K,
    ((NUM_DEATHS/total) * 10000) AS DEATHS_10K,
    DATE_HOSP
  FROM HOSPITALISATIONS H
  LEFT JOIN PROJET_POPU P
    ON P.codeD = H.DEP_ID
  WHERE SEX = 0 AND H.DATE_HOSP IS NOT NULL
  GROUP BY DATE_HOSP
  ORDER BY INTENSE_CARE_10K DESC, DEATHS_10K DESC"
)

cor_intense_case_deaths <- cor(
  intense_case_deaths_data$INTENSE_CARE_10K,
  intense_case_deaths_data$DEATHS_10K
)

print("Correlation: ", cor_intense_case_deaths)

plot(
  cor_intense_case_deaths$DATE_HOSP,
  cor_intense_case_deaths$intensive_care_rate,
  type = "l",
  col = "blue",
  xlab = "Date",
  ylab = "Rate",
  main = "Intensive Care Rate and Death Rate Over Time"
)
lines(
  cor_intense_case_deaths$DATE_HOSP,
  cor_intense_case_deaths$death_rate,
  col = "red"
)
legend(
  "topright",
  legend = c("Intensive Care Rate", "Death Rate"),
  col = c("blue", "red"),
  lty = 1,
  cex = 0.8
)
```
Un coefficient de corrélation de 0.55 indique une relation linéaire positive modérée entre le nombre de cas en soins intensifs et le nombre de décès. Cela suggère que, bien qu'il existe une association entre ces variables, d'autres facteurs influencent également les taux de mortalité dans les données d'hospitalisations.


### TAUX D'HOSPITALISATIONS PAR SAISON
On aimerais étudier le taux d'hospitalisations en fonctions de saisons

```{r TAUX D'HOSPITALISATION PAR SAISON}
hosp_rate_10K <- dbGetQuery(
  connection,
  "SELECT
    AVG((NUM_HOSP/total) * 10000) AS HOSP_RATE,
    CASE
      WHEN MONTH(DATE_HOSP) IN (12, 1, 2) THEN 'Winter'
      WHEN MONTH(DATE_HOSP) IN (3, 4, 5) THEN 'Spring'
      WHEN MONTH(DATE_HOSP) IN (6, 7, 8) THEN 'Summer'
      WHEN MONTH(DATE_HOSP) IN (9, 10, 11) THEN 'Autumn'
    END AS 'SEASONS'
  FROM HOSPITALISATIONS H
  INNER JOIN PROJET_POPU P
    ON H.DEP_ID = P.codeD
  GROUP BY SEASONS
  ORDER BY HOSP_RATE DESC"
)

print(hosp_rate_10K)
```
On remarque alors un fort taux d'hospitalisation en Hiver(2.364) et les saisons plus froides qu'en Été(0.660).


## ETUDE DE VARIABLE TEMPERATURE
--------------------------------
### Indice CDD/HDD
```{r GRAPH DE l'INDICE CDD/HDD}
cdd_hdd_query <- "
WITH HEATING_DAYS AS(
  SELECT SUM(18 - MEAN_TEMP) AS HDD, YEAR(DATE_TEMP) AS YEARS
  FROM TEMPERATURES
  WHERE MEAN_TEMP < 18
  GROUP BY YEARS
), COOLING_DAYS AS(
  SELECT SUM(MEAN_TEMP - 18) AS CDD, YEAR(DATE_TEMP) AS YEARS
  FROM TEMPERATURES
  WHERE MEAN_TEMP > 18
  GROUP BY YEARS
) 

SELECT
  YEAR(T.DATE_TEMP) AS YEARS,
  CD.CDD/HD.HDD AS `CDD/HDD INDEX`
FROM TEMPERATURES T
LEFT JOIN HEATING_DAYS HD
  ON YEAR(T.DATE_TEMP) = HD.YEARS
LEFT JOIN COOLING_DAYS CD
  ON CD.YEARS = YEAR(T.DATE_TEMP)
GROUP BY YEARS
ORDER BY YEARS ASC
"

cdd_hdd_data <- dbGetQuery(connection, cdd_hdd_query)

cdd_hdd_data$YEARS <- as.factor(cdd_hdd_data$YEARS)

plot(cdd_data$YEARS, cdd_hdd_data$`CDD/HDD INDEX`,
  type = "b",
  pch = 19,
  lty = 1,
  xlab = "Year",
  ylab = "CDD/HDD Index",
  main = "CDD/HDD Index Over Years"
)

```
Les indices CDD/HDD de 2018 à 2021 reflète partiellement la corrélation faible et négative trouvée entre les températures et les hospitalisations. Nous observons que les bâtiments nécessitaient davantage de chauffage entre 2018(0.184157) et 2020(0.171583), signifiant des températures généralement plus basses, tandis que les indices CDD et HDD tendent à se rapprocher en 2021(0.104421), indiquant une année avec des températures relativement plus équilibrées. Cependant, étant donné la faible corrélation entre la température et les taux d’hospitalisation, il serait prématuré de conclure directement que les cas de COVID-19 ont diminué au fil des ans en se basant uniquement sur cet indice.


## CORRELATION ENTRE LA TEMPERATURE ET LE TAUX D'HOSPITALSATION
----------------------------------
### COEFFICIENT DE CORRELATION ENTRE LA TEMPERATURE ET LE TAUX D'HOSPITALISATIONS
On aimerait voir s'il y a plus d'hospitalisations avec une hausse de la température ou l'inverse.
```{r GRAPH DE OEFFICIENT DE CORRELATION (TEMP vs TAUX HOSP) pressure, echo=FALSE}
temps_hosp_data <- dbGetQuery(
  connection,
  "SELECT MEAN_TEMP, ((NUM_HOSP/total) * 10000) AS HOSP_RATE_10K
  FROM TEMPERATURES T
  RIGHT JOIN HOSPITALISATIONS H
    ON H.DEP_ID = T.DEP_ID AND H.DATE_HOSP = T.DATE_TEMP
  INNER JOIN PROJET_POPU P
    ON P.codeD = H.DEP_ID
  WHERE SEX = 0 AND T.DEP_ID IS NOT NULL AND H.DATE_HOSP IS NOT NULL
  GROUP BY DATE_TEMP
  ORDER BY HOSP_RATE_10K DESC, MEAN_TEMP DESC"
)

cor_hosp_temp <- cor(
  temps_hosp_data$MEAN_TEMP,
  temps_hosp_data$HOSP_RATE_10K
)

plot(
  temps_hosp_data$MEAN_TEMP,
  temps_hosp_data$HOSP_RATE_10K,
  main = "SCATTER PLOT OF TEMP VS HOSPITALISATION RATE",
  xlab = "AVERAGE TEMPERAUTRES",
  ylab = "HOSPITALISATION RATE PER 10K",
  pch = 20
)
```
J’ai utilisé 10 000 habitants comme référence pour standardiser le taux d’hospitalisation. Selon le calcul du coefficient de corrélation, qui est de -0.21, il existe une faible relation négative entre la température et le taux d’hospitalisation. Cela suggère une légère tendance à la baisse des hospitalisations avec l’augmentation des températures. Toutefois, cette relation est faible et indique que d’autres facteurs pourraient jouer un rôle plus significatif dans les taux d’hospitalisation. Cette analyse met en lumière la complexité des facteurs affectant les hospitalisations.